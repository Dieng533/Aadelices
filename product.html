<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Produit - Aadelice</title>
    <!-- Bootstrap 5 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&family=Quicksand:wght@400;500;700&display=swap" rel="stylesheet">
    <!-- Styles -->
    <link rel="stylesheet" href="css/style.css">
    <style>
        /* Styles spécifiques à la page produit */
        .product-detail-page {
            padding: 50px 0;
        }
        
        .product-gallery {
            position: relative;
        }
        
        .main-product-image {
            width: 100%;
            height: 400px;
            object-fit: cover;
            border-radius: 15px;
            margin-bottom: 15px;
        }
        
        .product-thumbnails {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        
        .product-thumbnail {
            width: 80px;
            height: 80px;
            object-fit: cover;
            border-radius: 8px;
            cursor: pointer;
            opacity: 0.7;
            transition: all 0.3s ease;
            border: 2px solid transparent;
        }
        
        .product-thumbnail:hover,
        .product-thumbnail.active {
            opacity: 1;
            border-color: var(--primary);
        }
        
        .product-badge {
            position: absolute;
            top: 15px;
            left: 15px;
            background-color: var(--primary);
            color: white;
            padding: 5px 15px;
            border-radius: 50px;
            font-weight: 600;
            font-size: 0.9rem;
            z-index: 1;
        }
        
        .product-badge.new {
            background-color: var(--secondary);
        }
        
        .product-badge.popular {
            background-color: #FF9800;
        }
        
        .product-title {
            font-size: 2.5rem;
            color: var(--tertiary);
            margin-bottom: 15px;
        }
        
        .product-meta {
            display: flex;
            align-items: center;
            gap: 20px;
            margin-bottom: 20px;
            color: var(--gray);
        }
        
        .product-rating-large {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .product-rating-large .stars {
            color: #FFC107;
            font-size: 1.2rem;
        }
        
        .product-price-large {
            font-size: 2.2rem;
            font-weight: 700;
            color: var(--primary);
            margin-bottom: 20px;
        }
        
        .product-price-large .old-price {
            font-size: 1.5rem;
            color: var(--gray);
            text-decoration: line-through;
            margin-left: 10px;
        }
        
        .product-description-full {
            margin-bottom: 30px;
            line-height: 1.8;
        }
        
        .product-specifications {
            margin-bottom: 30px;
        }
        
        .spec-item {
            display: flex;
            margin-bottom: 10px;
        }
        
        .spec-label {
            font-weight: 600;
            color: var(--tertiary);
            width: 150px;
        }
        
        .spec-value {
            color: var(--gray);
        }
        
        .quantity-selector {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 25px;
        }
        
        .quantity-controls {
            display: flex;
            align-items: center;
            border: 1px solid #dee2e6;
            border-radius: 10px;
            overflow: hidden;
        }
        
        .quantity-btn {
            width: 45px;
            height: 45px;
            background-color: #f8f9fa;
            border: none;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .quantity-btn:hover {
            background-color: var(--primary);
            color: white;
        }
        
        .quantity-input {
            width: 70px;
            height: 45px;
            border: none;
            text-align: center;
            font-size: 1.2rem;
            font-weight: 600;
        }
        
        .stock-status {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 25px;
        }
        
        .stock-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
        }
        
        .stock-dot.in-stock {
            background-color: var(--secondary);
        }
        
        .stock-dot.low-stock {
            background-color: #FF9800;
        }
        
        .stock-dot.out-of-stock {
            background-color: #dc3545;
        }
        
        .action-buttons {
            display: flex;
            gap: 15px;
            margin-bottom: 30px;
        }
        
        .btn-add-to-cart-large {
            background-color: var(--primary);
            color: white;
            border: none;
            border-radius: 50px;
            padding: 15px 30px;
            font-weight: 600;
            font-size: 1.1rem;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            flex: 1;
            transition: all 0.3s ease;
        }
        
        .btn-add-to-cart-large:hover {
            background-color: var(--primary-light);
            transform: translateY(-3px);
            box-shadow: 0 10px 20px rgba(230, 0, 126, 0.2);
        }
        
        .btn-add-to-cart-large:disabled {
            background-color: #dee2e6;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        
        .btn-wishlist {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background-color: white;
            border: 1px solid #dee2e6;
            color: var(--tertiary);
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }
        
        .btn-wishlist:hover {
            border-color: var(--primary);
            color: var(--primary);
        }
        
        .btn-wishlist.active {
            background-color: var(--primary);
            border-color: var(--primary);
            color: white;
        }
        
        .product-features {
            background-color: white;
            border-radius: 15px;
            padding: 25px;
            margin-top: 30px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
        }
        
        .feature-item {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .feature-icon {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background-color: rgba(230, 0, 126, 0.1);
            color: var(--primary);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
        }
        
        .feature-text h6 {
            margin: 0;
            color: var(--tertiary);
        }
        
        .feature-text p {
            margin: 5px 0 0;
            color: var(--gray);
            font-size: 0.9rem;
        }
        
        .related-products {
            margin-top: 50px;
            padding-top: 50px;
            border-top: 1px solid #eee;
        }
        
        .product-tabs {
            margin-top: 50px;
        }
        
        .nav-tabs-custom {
            border-bottom: 2px solid #dee2e6;
        }
        
        .nav-tabs-custom .nav-link {
            color: var(--gray);
            border: none;
            padding: 15px 30px;
            font-weight: 600;
            border-radius: 10px 10px 0 0;
            margin-right: 5px;
        }
        
        .nav-tabs-custom .nav-link.active {
            color: var(--primary);
            background-color: white;
            border-bottom: 3px solid var(--primary);
        }
        
        .tab-content {
            background-color: white;
            border-radius: 0 0 15px 15px;
            padding: 30px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
        }
        
        .reviews-summary {
            display: flex;
            align-items: center;
            gap: 30px;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid #eee;
        }
        
        .average-rating {
            text-align: center;
        }
        
        .rating-number {
            font-size: 3rem;
            font-weight: 700;
            color: var(--tertiary);
            line-height: 1;
        }
        
        .rating-stars {
            color: #FFC107;
            margin: 10px 0;
        }
        
        .rating-count {
            color: var(--gray);
        }
        
        .rating-bars {
            flex: 1;
        }
        
        .rating-bar {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 10px;
        }
        
        .rating-label {
            width: 100px;
            color: var(--gray);
        }
        
        .rating-progress {
            flex: 1;
            height: 10px;
            background-color: #f0f0f0;
            border-radius: 5px;
            overflow: hidden;
        }
        
        .rating-progress-bar {
            height: 100%;
            background-color: #FFC107;
        }
        
        .review-item {
            padding: 20px 0;
            border-bottom: 1px solid #eee;
        }
        
        .review-item:last-child {
            border-bottom: none;
        }
        
        .review-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        
        .review-author {
            font-weight: 600;
            color: var(--tertiary);
        }
        
        .review-date {
            color: var(--gray);
            font-size: 0.9rem;
        }
        
        .review-rating {
            color: #FFC107;
            margin-bottom: 10px;
        }
        
        .review-text {
            color: var(--tertiary);
            line-height: 1.6;
        }
        
        .review-form {
            margin-top: 30px;
        }
        
        @media (max-width: 768px) {
            .product-title {
                font-size: 2rem;
            }
            
            .product-price-large {
                font-size: 1.8rem;
            }
            
            .action-buttons {
                flex-direction: column;
            }
            
            .btn-wishlist {
                width: 100%;
                border-radius: 50px;
                height: 50px;
            }
            
            .reviews-summary {
                flex-direction: column;
                text-align: center;
            }
        }
    </style>
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg navbar-light bg-white sticky-top shadow-sm py-3">
        <div class="container">
            <a class="navbar-brand" href="index.html">Aa<span>delice</span></a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav mx-auto">
                    <li class="nav-item">
                        <a class="nav-link" href="index.html">Accueil</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="index.html#produits">Bonbons</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="index.html#categories">Catégories</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#about">À propos</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#contact">Contact</a>
                    </li>
                </ul>
                <div class="d-flex align-items-center">
                    <a href="cart.html" class="cart-icon me-4">
                        <i class="fas fa-shopping-bag"></i>
                        <span class="cart-count">0</span>
                    </a>
                    <a href="admin.html" class="btn btn-primary-custom">Admin</a>
                </div>
            </div>
        </div>
    </nav>

    <!-- Page Produit -->
    <section class="product-detail-page">
        <div class="container">
            <!-- Fil d'Ariane -->
            <nav aria-label="breadcrumb" class="mb-4">
                <ol class="breadcrumb breadcrumb-custom">
                    <li class="breadcrumb-item"><a href="index.html">Accueil</a></li>
                    <li class="breadcrumb-item"><a href="index.html#produits">Bonbons</a></li>
                    <li class="breadcrumb-item"><a href="#" id="productCategoryLink">Catégorie</a></li>
                    <li class="breadcrumb-item active" id="productTitleBreadcrumb" aria-current="page">Produit</li>
                </ol>
            </nav>
            
            <div class="row">
                <!-- Galerie produit -->
                <div class="col-lg-6">
                    <div class="product-gallery">
                        <div class="product-badge popular">Populaire</div>
                        <img src="" alt="Produit" class="main-product-image" id="mainProductImage">
                        
                        <div class="product-thumbnails" id="productThumbnails">
                            <!-- Les miniatures seront générées dynamiquement -->
                        </div>
                    </div>
                </div>
                
                <!-- Informations produit -->
                <div class="col-lg-6">
                    <h1 class="product-title" id="productTitle">Chargement...</h1>
                    
                    <div class="product-meta">
                        <div class="product-rating-large" id="productRating">
                            <div class="stars">
                                <i class="fas fa-star"></i>
                                <i class="fas fa-star"></i>
                                <i class="fas fa-star"></i>
                                <i class="fas fa-star"></i>
                                <i class="far fa-star"></i>
                            </div>
                            <span id="reviewCount">(0 avis)</span>
                        </div>
                        <div id="productCategory" class="badge-custom badge-secondary-custom">Catégorie</div>
                        <div id="productSku">Réf: <span>000</span></div>
                    </div>
                    
                    <div class="product-price-large">
                        <span id="productPrice">0,00</span> €
                        <span class="old-price" id="oldPrice">0,00 €</span>
                    </div>
                    
                    <div class="product-description-full" id="productDescriptionFull">
                        Chargement de la description...
                    </div>
                    
                    <div class="product-specifications" id="productSpecifications">
                        <!-- Spécifications chargées dynamiquement -->
                    </div>
                    
                    <div class="quantity-selector">
                        <label for="quantity" class="form-label">Quantité:</label>
                        <div class="quantity-controls">
                            <button class="quantity-btn" id="decreaseQuantity">-</button>
                            <input type="number" class="quantity-input" id="quantity" value="1" min="1" max="99">
                            <button class="quantity-btn" id="increaseQuantity">+</button>
                        </div>
                    </div>
                    
                    <div class="stock-status" id="stockStatus">
                        <div class="stock-dot in-stock"></div>
                        <span id="stockText">En stock</span>
                    </div>
                    
                    <div class="action-buttons">
                        <button class="btn-add-to-cart-large" id="addToCartBtn">
                            <i class="fas fa-cart-plus"></i>
                            Ajouter au panier
                        </button>
                        <button class="btn-wishlist" id="wishlistBtn" title="Ajouter aux favoris">
                            <i class="far fa-heart"></i>
                        </button>
                    </div>
                    
                    <div class="product-features">
                        <div class="feature-item">
                            <div class="feature-icon">
                                <i class="fas fa-shipping-fast"></i>
                            </div>
                            <div class="feature-text">
                                <h6>Livraison rapide</h6>
                                <p>Expédition sous 24h</p>
                            </div>
                        </div>
                        <div class="feature-item">
                            <div class="feature-icon">
                                <i class="fas fa-shield-alt"></i>
                            </div>
                            <div class="feature-text">
                                <h6>Paiement sécurisé</h6>
                                <p>100% sécurisé avec SSL</p>
                            </div>
                        </div>
                        <div class="feature-item">
                            <div class="feature-icon">
                                <i class="fas fa-undo"></i>
                            </div>
                            <div class="feature-text">
                                <h6>Satisfait ou remboursé</h6>
                                <p>30 jours pour changer d'avis</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Onglets produit -->
            <div class="product-tabs">
                <ul class="nav nav-tabs nav-tabs-custom" id="productTabs" role="tablist">
                    <li class="nav-item" role="presentation">
                        <button class="nav-link active" id="description-tab" data-bs-toggle="tab" data-bs-target="#description" type="button" role="tab">
                            Description
                        </button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="specifications-tab" data-bs-toggle="tab" data-bs-target="#specifications" type="button" role="tab">
                            Spécifications
                        </button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="reviews-tab" data-bs-toggle="tab" data-bs-target="#reviews" type="button" role="tab">
                            Avis clients (0)
                        </button>
                    </li>
                </ul>
                
                <div class="tab-content" id="productTabsContent">
                    <!-- Description -->
                    <div class="tab-pane fade show active" id="description" role="tabpanel">
                        <div id="tabDescription">
                            <p>Chargement de la description détaillée...</p>
                        </div>
                    </div>
                    
                    <!-- Spécifications -->
                    <div class="tab-pane fade" id="specifications" role="tabpanel">
                        <div class="row" id="tabSpecifications">
                            <!-- Chargé dynamiquement -->
                        </div>
                    </div>
                    
                    <!-- Avis -->
                    <div class="tab-pane fade" id="reviews" role="tabpanel">
                        <div class="reviews-summary" id="reviewsSummary">
                            <!-- Résumé des avis -->
                        </div>
                        
                        <div id="reviewsList">
                            <!-- Liste des avis -->
                            <p class="text-center text-muted py-4" id="noReviewsMessage">
                                Aucun avis pour ce produit. Soyez le premier à laisser un avis !
                            </p>
                        </div>
                        
                        <!-- Formulaire d'avis -->
                        <div class="review-form">
                            <h5>Laisser un avis</h5>
                            <form id="reviewForm">
                                <div class="row">
                                    <div class="col-md-6 mb-3">
                                        <input type="text" class="form-control-custom" placeholder="Votre nom" required>
                                    </div>
                                    <div class="col-md-6 mb-3">
                                        <input type="email" class="form-control-custom" placeholder="Votre email" required>
                                    </div>
                                </div>
                                
                                <div class="mb-3">
                                    <label class="form-label">Votre note</label>
                                    <div class="rating-input">
                                        <div class="stars-input">
                                            <i class="far fa-star" data-rating="1"></i>
                                            <i class="far fa-star" data-rating="2"></i>
                                            <i class="far fa-star" data-rating="3"></i>
                                            <i class="far fa-star" data-rating="4"></i>
                                            <i class="far fa-star" data-rating="5"></i>
                                        </div>
                                        <input type="hidden" id="ratingValue" name="rating" value="0">
                                    </div>
                                </div>
                                
                                <div class="mb-3">
                                    <textarea class="form-control-custom form-textarea" placeholder="Votre avis..." rows="4" required></textarea>
                                </div>
                                
                                <button type="submit" class="btn btn-primary-custom">Envoyer mon avis</button>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Produits similaires -->
            <div class="related-products">
                <h2 class="section-title">Vous aimerez aussi</h2>
                <div class="row g-4" id="relatedProducts">
                    <!-- Produits similaires chargés dynamiquement -->
                </div>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <div class="row">
                <div class="col-lg-4 mb-4">
                    <div class="footer-logo">Aa<span>delice</span></div>
                    <p>Depuis 2023, Aadelice réinvente l'art de la confiserie avec des créations uniques qui ravissent petits et grands.</p>
                    <div class="social-icons">
                        <a href="#"><i class="fab fa-facebook-f"></i></a>
                        <a href="#"><i class="fab fa-instagram"></i></a>
                        <a href="#"><i class="fab fa-tiktok"></i></a>
                        <a href="#"><i class="fab fa-pinterest"></i></a>
                    </div>
                </div>
                <div class="col-lg-2 col-md-4 mb-4">
                    <h5 class="footer-heading">Boutique</h5>
                    <ul class="footer-links">
                        <li><a href="index.html#produits">Tous les bonbons</a></li>
                        <li><a href="#">Nouveautés</a></li>
                        <li><a href="#">Best-sellers</a></li>
                        <li><a href="#">Offres spéciales</a></li>
                        <li><a href="#">Cadeaux</a></li>
                    </ul>
                </div>
                <div class="col-lg-2 col-md-4 mb-4">
                    <h5 class="footer-heading">Informations</h5>
                    <ul class="footer-links">
                        <li><a href="#">À propos</a></li>
                        <li><a href="#">Livraison</a></li>
                        <li><a href="#">Paiement sécurisé</a></li>
                        <li><a href="#">FAQ</a></li>
                        <li><a href="#">Contact</a></li>
                    </ul>
                </div>
                <div class="col-lg-4 col-md-4 mb-4">
                    <h5 class="footer-heading">Contact</h5>
                    <ul class="footer-links">
                        <li><i class="fas fa-map-marker-alt me-2"></i> 123 Rue des Douceurs, 75000 Paris</li>
                        <li><i class="fas fa-phone me-2"></i> +33 1 23 45 67 89</li>
                        <li><i class="fas fa-envelope me-2"></i> contact@aadelice.fr</li>
                        <li><i class="fas fa-clock me-2"></i> Lun-Sam: 9h-19h</li>
                    </ul>
                </div>
            </div>
            <div class="footer-bottom">
                <p>&copy; 2023 Aadelice. Tous droits réservés. | <a href="#" class="text-white">Mentions légales</a> | <a href="#" class="text-white">Politique de confidentialité</a></p>
            </div>
        </div>
    </footer>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="js/products.js"></script>
    <script src="js/cart.js"></script>
    <script>
        // Gestion de la page produit
        class ProductPage {
            constructor() {
                this.productId = this.getProductIdFromUrl();
                this.productManager = new ProductManager();
                this.cart = JSON.parse(localStorage.getItem('aadeliceCart')) || [];
                this.wishlist = JSON.parse(localStorage.getItem('aadeliceWishlist')) || [];
                
                this.init();
            }
            
            getProductIdFromUrl() {
                const urlParams = new URLSearchParams(window.location.search);
                return urlParams.get('id') || 1;
            }
            
            async init() {
                await this.loadProduct();
                this.initEvents();
                this.updateCartCount();
                this.updateWishlistButton();
                this.loadRelatedProducts();
            }
            
            async loadProduct() {
                try {
                    const product = await this.productManager.getProductById(this.productId);
                    
                    if (product) {
                        this.displayProduct(product);
                        this.generateThumbnails(product);
                        this.updateBreadcrumb(product);
                        this.generateSpecifications(product);
                        this.loadReviews();
                    } else {
                        this.showError('Produit non trouvé');
                    }
                } catch (error) {
                    console.error('Erreur lors du chargement du produit:', error);
                    this.showError('Erreur lors du chargement du produit');
                }
            }
            
            displayProduct(product) {
                // Titre et méta
                document.getElementById('productTitle').textContent = product.name;
                document.getElementById('productTitleBreadcrumb').textContent = product.name;
                document.getElementById('productCategory').textContent = product.category;
                document.getElementById('productCategoryLink').textContent = product.category;
                document.getElementById('productSku').querySelector('span').textContent = product.id.toString().padStart(3, '0');
                
                // Prix
                document.getElementById('productPrice').textContent = product.price.toFixed(2).replace('.', ',');
                
                // Description
                document.getElementById('productDescriptionFull').textContent = product.description;
                document.getElementById('tabDescription').innerHTML = `
                    <p>${product.description}</p>
                    <p>Découvrez ce délice exceptionnel qui ravira vos papilles. Fabriqué avec soin et passion pour vous offrir une expérience gustative unique.</p>
                `;
                
                // Image principale
                document.getElementById('mainProductImage').src = product.image;
                document.getElementById('mainProductImage').alt = product.name;
                
                // Rating
                this.displayRating(product.rating, product.reviews);
                
                // Stock
                this.updateStockDisplay(product.stock);
                
                // Bouton ajouter au panier
                const addToCartBtn = document.getElementById('addToCartBtn');
                if (product.stock === 0) {
                    addToCartBtn.textContent = 'Rupture de stock';
                    addToCartBtn.disabled = true;
                }
            }
            
            displayRating(rating, reviews) {
                const ratingElement = document.getElementById('productRating');
                const reviewCountElement = document.getElementById('reviewCount');
                const reviewsTab = document.getElementById('reviews-tab');
                
                // Générer les étoiles
                let starsHtml = '';
                const fullStars = Math.floor(rating);
                const hasHalfStar = rating % 1 >= 0.5;
                
                for (let i = 0; i < 5; i++) {
                    if (i < fullStars) {
                        starsHtml += '<i class="fas fa-star"></i>';
                    } else if (i === fullStars && hasHalfStar) {
                        starsHtml += '<i class="fas fa-star-half-alt"></i>';
                    } else {
                        starsHtml += '<i class="far fa-star"></i>';
                    }
                }
                
                ratingElement.querySelector('.stars').innerHTML = starsHtml;
                reviewCountElement.textContent = `(${reviews} avis)`;
                reviewsTab.textContent = `Avis clients (${reviews})`;
            }
            
            generateThumbnails(product) {
                const thumbnailsContainer = document.getElementById('productThumbnails');
                
                // Image principale comme première miniature
                const mainThumbnail = document.createElement('img');
                mainThumbnail.src = product.image;
                mainThumbnail.alt = `${product.name} - vue 1`;
                mainThumbnail.className = 'product-thumbnail active';
                mainThumbnail.addEventListener('click', () => {
                    document.getElementById('mainProductImage').src = product.image;
                    this.setActiveThumbnail(mainThumbnail);
                });
                thumbnailsContainer.appendChild(mainThumbnail);
                
                // Images supplémentaires (simulées)
                const additionalImages = [
                    'https://images.unsplash.com/photo-1514517260014-8c6c2c58b5b9?ixlib=rb-4.0.3&auto=format&fit=crop&w=300&q=80',
                    'https://images.unsplash.com/photo-1575224300306-1b8da36134ec?ixlib=rb-4.0.3&auto=format&fit=crop&w=300&q=80',
                    'https://images.unsplash.com/photo-1590099033615-be195f8d575c?ixlib=rb-4.0.3&auto=format&fit=crop&w=300&q=80'
                ];
                
                additionalImages.forEach((image, index) => {
                    const thumbnail = document.createElement('img');
                    thumbnail.src = image;
                    thumbnail.alt = `${product.name} - vue ${index + 2}`;
                    thumbnail.className = 'product-thumbnail';
                    thumbnail.addEventListener('click', () => {
                        document.getElementById('mainProductImage').src = image;
                        this.setActiveThumbnail(thumbnail);
                    });
                    thumbnailsContainer.appendChild(thumbnail);
                });
            }
            
            setActiveThumbnail(activeThumbnail) {
                document.querySelectorAll('.product-thumbnail').forEach(thumb => {
                    thumb.classList.remove('active');
                });
                activeThumbnail.classList.add('active');
            }
            
            updateBreadcrumb(product) {
                document.getElementById('productCategoryLink').href = `#${product.category.toLowerCase()}`;
            }
            
            generateSpecifications(product) {
                const specsContainer = document.getElementById('productSpecifications');
                const tabContainer = document.getElementById('tabSpecifications');
                
                const specifications = {
                    'Poids': '100g',
                    'Allergènes': 'Contient: fruits à coque, lait. Peut contenir des traces de: soja, sésame.',
                    'Conservation': 'À conserver dans un endroit frais et sec',
                    'Origine': 'Fabriqué en France',
                    'Certifications': product.category === 'Acidulé' ? 'Halal, Sans gluten' : 'Sans gluten'
                };
                
                // Spécifications dans la colonne principale
                let specsHtml = '';
                for (const [key, value] of Object.entries(specifications)) {
                    specsHtml += `
                        <div class="spec-item">
                            <div class="spec-label">${key}</div>
                            <div class="spec-value">${value}</div>
                        </div>
                    `;
                }
                specsContainer.innerHTML = specsHtml;
                
                // Spécifications dans l'onglet
                tabContainer.innerHTML = `
                    <div class="col-md-6">
                        <div class="spec-item">
                            <div class="spec-label">Catégorie</div>
                            <div class="spec-value">${product.category}</div>
                        </div>
                        <div class="spec-item">
                            <div class="spec-label">Poids net</div>
                            <div class="spec-value">100g</div>
                        </div>
                        <div class="spec-item">
                            <div class="spec-label">Allergènes</div>
                            <div class="spec-value">Contient: fruits à coque, lait</div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="spec-item">
                            <div class="spec-label">Conservation</div>
                            <div class="spec-value">À conserver au frais et au sec</div>
                        </div>
                        <div class="spec-item">
                            <div class="spec-label">Origine</div>
                            <div class="spec-value">Fabriqué en France</div>
                        </div>
                        <div class="spec-item">
                            <div class="spec-label">DLC</div>
                            <div class="spec-value">12 mois après fabrication</div>
                        </div>
                    </div>
                `;
            }
            
            updateStockDisplay(stock) {
                const stockDot = document.querySelector('.stock-dot');
                const stockText = document.getElementById('stockText');
                
                if (stock === 0) {
                    stockDot.className = 'stock-dot out-of-stock';
                    stockText.textContent = 'Rupture de stock';
                } else if (stock < 10) {
                    stockDot.className = 'stock-dot low-stock';
                    stockText.textContent = `Plus que ${stock} en stock`;
                } else {
                    stockDot.className = 'stock-dot in-stock';
                    stockText.textContent = 'En stock';
                }
            }
            
            async loadRelatedProducts() {
                try {
                    const products = await this.productManager.getProducts();
                    const currentProductId = parseInt(this.productId);
                    
                    // Filtrer les produits de même catégorie, exclure le produit actuel
                    const related = products
                        .filter(p => p.id !== currentProductId)
                        .slice(0, 4);
                    
                    this.displayRelatedProducts(related);
                } catch (error) {
                    console.error('Erreur lors du chargement des produits similaires:', error);
                }
            }
            
            displayRelatedProducts(products) {
                const container = document.getElementById('relatedProducts');
                
                if (products.length === 0) {
                    container.innerHTML = '<p class="text-center text-muted py-4">Aucun produit similaire disponible</p>';
                    return;
                }
                
                let html = '';
                
                products.forEach(product => {
                    const stockClass = this.getStockClass(product.stock);
                    const stockText = this.getStockText(product.stock);
                    
                    html += `
                        <div class="col-md-6 col-lg-3">
                            <div class="product-card">
                                <img src="${product.image}" class="product-image" alt="${product.name}">
                                <div class="p-3">
                                    <div class="product-category">${product.category}</div>
                                    <h5 class="product-title">${product.name}</h5>
                                    <div class="product-rating">
                                        ${this.generateStarRating(product.rating)}
                                        <span>(${product.reviews})</span>
                                    </div>
                                    <div class="d-flex justify-content-between align-items-center">
                                        <div class="product-price">${product.price.toFixed(2).replace('.', ',')} €</div>
                                        <div class="product-stock ${stockClass}">${stockText}</div>
                                    </div>
                                    <a href="product.html?id=${product.id}" class="btn btn-add-to-cart mt-3">
                                        <i class="fas fa-eye me-2"></i>Voir le produit
                                    </a>
                                </div>
                            </div>
                        </div>
                    `;
                });
                
                container.innerHTML = html;
            }
            
            generateStarRating(rating) {
                let stars = '';
                const fullStars = Math.floor(rating);
                const hasHalfStar = rating % 1 >= 0.5;
                
                for (let i = 0; i < 5; i++) {
                    if (i < fullStars) {
                        stars += '<i class="fas fa-star"></i>';
                    } else if (i === fullStars && hasHalfStar) {
                        stars += '<i class="fas fa-star-half-alt"></i>';
                    } else {
                        stars += '<i class="far fa-star"></i>';
                    }
                }
                
                return stars;
            }
            
            getStockClass(stock) {
                if (stock === 0) return 'out-of-stock';
                if (stock < 10) return 'low-stock';
                return 'in-stock';
            }
            
            getStockText(stock) {
                if (stock === 0) return 'Rupture';
                if (stock < 10) return `Plus que ${stock}`;
                return 'En stock';
            }
            
            loadReviews() {
                // Simulation d'avis
                const reviews = [
                    {
                        id: 1,
                        author: 'Marie D.',
                        rating: 5,
                        date: '2023-11-15',
                        text: 'Excellent produit ! Mes enfants adorent, et je trouve que le rapport qualité/prix est très bon.'
                    },
                    {
                        id: 2,
                        author: 'Pierre L.',
                        rating: 4,
                        date: '2023-11-10',
                        text: 'Très bon bonbons, juste ce qu\'il faut d\'acidulé. Je recommande !'
                    }
                ];
                
                this.displayReviews(reviews);
            }
            
            displayReviews(reviews) {
                const reviewsList = document.getElementById('reviewsList');
                const noReviewsMessage = document.getElementById('noReviewsMessage');
                const reviewsSummary = document.getElementById('reviewsSummary');
                
                if (reviews.length === 0) {
                    noReviewsMessage.classList.remove('d-none');
                    return;
                }
                
                noReviewsMessage.classList.add('d-none');
                
                // Résumé des avis
                const averageRating = reviews.reduce((sum, review) => sum + review.rating, 0) / reviews.length;
                const ratingCounts = {5: 0, 4: 0, 3: 0, 2: 0, 1: 0};
                reviews.forEach(review => ratingCounts[review.rating]++);
                
                reviewsSummary.innerHTML = `
                    <div class="average-rating">
                        <div class="rating-number">${averageRating.toFixed(1)}</div>
                        <div class="rating-stars">${this.generateStarRating(averageRating)}</div>
                        <div class="rating-count">${reviews.length} avis</div>
                    </div>
                    <div class="rating-bars">
                        ${[5, 4, 3, 2, 1].map(stars => {
                            const count = ratingCounts[stars] || 0;
                            const percentage = reviews.length > 0 ? (count / reviews.length) * 100 : 0;
                            return `
                                <div class="rating-bar">
                                    <div class="rating-label">${stars} étoiles</div>
                                    <div class="rating-progress">
                                        <div class="rating-progress-bar" style="width: ${percentage}%"></div>
                                    </div>
                                    <div class="rating-count">${count}</div>
                                </div>
                            `;
                        }).join('')}
                    </div>
                `;
                
                // Liste des avis
                let reviewsHtml = '';
                reviews.forEach(review => {
                    reviewsHtml += `
                        <div class="review-item">
                            <div class="review-header">
                                <div class="review-author">${review.author}</div>
                                <div class="review-date">${new Date(review.date).toLocaleDateString('fr-FR')}</div>
                            </div>
                            <div class="review-rating">${this.generateStarRating(review.rating)}</div>
                            <div class="review-text">${review.text}</div>
                        </div>
                    `;
                });
                
                reviewsList.innerHTML = reviewsHtml;
            }
            
            initEvents() {
                // Quantité
                document.getElementById('increaseQuantity').addEventListener('click', () => {
                    const quantityInput = document.getElementById('quantity');
                    let value = parseInt(quantityInput.value);
                    if (value < 99) {
                        quantityInput.value = value + 1;
                    }
                });
                
                document.getElementById('decreaseQuantity').addEventListener('click', () => {
                    const quantityInput = document.getElementById('quantity');
                    let value = parseInt(quantityInput.value);
                    if (value > 1) {
                        quantityInput.value = value - 1;
                    }
                });
                
                document.getElementById('quantity').addEventListener('change', (e) => {
                    let value = parseInt(e.target.value);
                    if (isNaN(value) || value < 1) {
                        e.target.value = 1;
                    } else if (value > 99) {
                        e.target.value = 99;
                    }
                });
                
                // Ajouter au panier
                document.getElementById('addToCartBtn').addEventListener('click', async () => {
                    await this.addToCart();
                });
                
                // Wishlist
                document.getElementById('wishlistBtn').addEventListener('click', () => {
                    this.toggleWishlist();
                });
                
                // Évaluation
                document.querySelectorAll('.stars-input i').forEach(star => {
                    star.addEventListener('click', (e) => {
                        const rating = parseInt(e.target.getAttribute('data-rating'));
                        this.setRating(rating);
                    });
                    
                    star.addEventListener('mouseover', (e) => {
                        const rating = parseInt(e.target.getAttribute('data-rating'));
                        this.hoverRating(rating);
                    });
                });
                
                document.querySelector('.stars-input').addEventListener('mouseleave', () => {
                    const currentRating = parseInt(document.getElementById('ratingValue').value);
                    this.hoverRating(currentRating);
                });
                
                // Formulaire d'avis
                document.getElementById('reviewForm').addEventListener('submit', (e) => {
                    e.preventDefault();
                    this.submitReview();
                });
            }
            
            async addToCart() {
                try {
                    const product = await this.productManager.getProductById(this.productId);
                    if (!product) return;
                    
                    const quantity = parseInt(document.getElementById('quantity').value);
                    
                    // Vérifier le stock
                    if (product.stock < quantity) {
                        alert(`Désolé, il ne reste que ${product.stock} unités en stock.`);
                        return;
                    }
                    
                    // Ajouter au panier
                    const existingItem = this.cart.find(item => item.id == product.id);
                    
                    if (existingItem) {
                        existingItem.quantity += quantity;
                    } else {
                        this.cart.push({
                            id: product.id,
                            name: product.name,
                            price: product.price,
                            image: product.image,
                            quantity: quantity
                        });
                    }
                    
                    localStorage.setItem('aadeliceCart', JSON.stringify(this.cart));
                    this.updateCartCount();
                    
                    // Afficher une notification
                    this.showNotification(`${product.name} ajouté au panier!`);
                    
                } catch (error) {
                    console.error('Erreur lors de l\'ajout au panier:', error);
                    alert('Une erreur est survenue');
                }
            }
            
            toggleWishlist() {
                const productId = parseInt(this.productId);
                const wishlistBtn = document.getElementById('wishlistBtn');
                const heartIcon = wishlistBtn.querySelector('i');
                
                const index = this.wishlist.indexOf(productId);
                
                if (index === -1) {
                    // Ajouter à la wishlist
                    this.wishlist.push(productId);
                    wishlistBtn.classList.add('active');
                    heartIcon.className = 'fas fa-heart';
                    this.showNotification('Produit ajouté aux favoris!');
                } else {
                    // Retirer de la wishlist
                    this.wishlist.splice(index, 1);
                    wishlistBtn.classList.remove('active');
                    heartIcon.className = 'far fa-heart';
                    this.showNotification('Produit retiré des favoris!');
                }
                
                localStorage.setItem('aadeliceWishlist', JSON.stringify(this.wishlist));
            }
            
            updateWishlistButton() {
                const productId = parseInt(this.productId);
                const wishlistBtn = document.getElementById('wishlistBtn');
                const heartIcon = wishlistBtn.querySelector('i');
                
                if (this.wishlist.includes(productId)) {
                    wishlistBtn.classList.add('active');
                    heartIcon.className = 'fas fa-heart';
                }
            }
            
            setRating(rating) {
                document.getElementById('ratingValue').value = rating;
                this.hoverRating(rating);
            }
            
            hoverRating(rating) {
                const stars = document.querySelectorAll('.stars-input i');
                stars.forEach((star, index) => {
                    if (index < rating) {
                        star.className = 'fas fa-star';
                    } else {
                        star.className = 'far fa-star';
                    }
                });
            }
            
            submitReview() {
                // Simulation d'envoi d'avis
                alert('Merci pour votre avis ! Il sera publié après modération.');
                document.getElementById('reviewForm').reset();
                document.getElementById('ratingValue').value = 0;
                this.hoverRating(0);
            }
            
            updateCartCount() {
                const totalItems = this.cart.reduce((sum, item) => sum + item.quantity, 0);
                const cartCountElements = document.querySelectorAll('.cart-count');
                
                cartCountElements.forEach(element => {
                    element.textContent = totalItems;
                });
            }
            
            showNotification(message) {
                const notification = document.createElement('div');
                notification.className = 'position-fixed top-0 end-0 m-3 p-3 bg-success text-white rounded-3 shadow';
                notification.style.zIndex = '1060';
                notification.innerHTML = `
                    <i class="fas fa-check-circle me-2"></i>
                    ${message}
                `;
                document.body.appendChild(notification);
                
                setTimeout(() => {
                    notification.remove();
                }, 3000);
            }
            
            showError(message) {
                const container = document.querySelector('.product-detail-page .container');
                container.innerHTML = `
                    <div class="text-center py-5">
                        <i class="fas fa-exclamation-triangle fa-3x text-warning mb-3"></i>
                        <h3>${message}</h3>
                        <p class="text-muted mb-4">Nous n'avons pas pu charger ce produit</p>
                        <a href="index.html" class="btn btn-primary-custom">Retour à l'accueil</a>
                    </div>
                `;
            }
        }
        
        // Initialiser la page produit
        document.addEventListener('DOMContentLoaded', () => {
            window.productPage = new ProductPage();
        });
    </script>
</body>
</html>